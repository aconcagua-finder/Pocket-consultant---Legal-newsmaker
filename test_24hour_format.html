<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест 24-часового формата времени</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #444;
            border-radius: 8px;
        }
        
        h2 {
            color: #4CAF50;
        }
        
        input[type="time"] {
            padding: 8px;
            font-size: 16px;
            background: #333;
            color: #fff;
            border: 1px solid #666;
            border-radius: 4px;
            width: 200px;
        }
        
        /* Force 24-hour format */
        input[type="time"]::-webkit-datetime-edit-ampm-field {
            display: none !important;
        }
        
        input[type="time"]::-moz-time-ampm-field {
            display: none !important;
        }
        
        .time-display {
            padding: 10px;
            background: #2a2a2a;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 18px;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px 0;
        }
        
        .status.success {
            background: #4CAF50;
        }
        
        .status.error {
            background: #f44336;
        }
    </style>
</head>
<body>
    <h1>Тест 24-часового формата времени</h1>
    
    <div class="test-section">
        <h2>1. Тест полей ввода времени</h2>
        <p>Эти поля должны показывать время в 24-часовом формате:</p>
        
        <div>
            <label>Время сбора новостей:</label><br>
            <input type="time" id="collection-time" value="08:30" step="60" pattern="[0-9]{2}:[0-9]{2}">
        </div>
        
        <div style="margin-top: 10px;">
            <label>Время публикации 1:</label><br>
            <input type="time" id="pub-time-1" value="09:05" step="60" pattern="[0-9]{2}:[0-9]{2}">
        </div>
        
        <div style="margin-top: 10px;">
            <label>Время публикации 2:</label><br>
            <input type="time" id="pub-time-2" value="15:30" step="60" pattern="[0-9]{2}:[0-9]{2}">
        </div>
        
        <div style="margin-top: 10px;">
            <label>Время публикации 3:</label><br>
            <input type="time" id="pub-time-3" value="21:07" step="60" pattern="[0-9]{2}:[0-9]{2}">
        </div>
    </div>
    
    <div class="test-section">
        <h2>2. Тест JavaScript форматирования</h2>
        <p>Текущее время (должно быть в 24-часовом формате):</p>
        
        <div class="time-display" id="current-time-24">--:--:--</div>
        <div class="status" id="time-status">Проверка...</div>
    </div>
    
    <div class="test-section">
        <h2>3. Тест различных методов форматирования</h2>
        
        <div>
            <strong>toLocaleTimeString с hour12: false:</strong>
            <div class="time-display" id="locale-time-24">--:--:--</div>
        </div>
        
        <div>
            <strong>Ручное форматирование:</strong>
            <div class="time-display" id="manual-time-24">--:--:--</div>
        </div>
        
        <div>
            <strong>Проверка на AM/PM:</strong>
            <div class="time-display" id="ampm-check">Проверка...</div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>4. Результаты тестов</h2>
        <div id="test-results"></div>
    </div>
    
    <script>
        // Helper function to format time in 24-hour format
        function formatTime24(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }
        
        // Enforce 24-hour format on all time inputs
        function enforceTime24Format() {
            document.querySelectorAll('input[type="time"]').forEach(input => {
                input.addEventListener('change', function() {
                    // Remove any AM/PM if present
                    let cleanValue = this.value.replace(/\\s?(AM|PM|am|pm)\\s?/gi, '').trim();
                    
                    // Parse and reformat
                    const parts = cleanValue.split(':');
                    if (parts.length >= 2) {
                        let hours = parseInt(parts[0]) || 0;
                        const minutes = parseInt(parts[1]) || 0;
                        
                        // Ensure 24-hour format
                        hours = Math.max(0, Math.min(23, hours));
                        this.value = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                    }
                });
            });
        }
        
        // Update time displays
        function updateTimeDisplays() {
            const now = new Date();
            const results = [];
            
            // Method 1: toLocaleTimeString with hour12: false
            let localeTime;
            try {
                localeTime = now.toLocaleTimeString('ru-RU', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
                // Remove any AM/PM if still present
                localeTime = localeTime.replace(/\\s?(AM|PM|am|pm)\\s?/gi, '').trim();
                document.getElementById('locale-time-24').textContent = localeTime;
                
                // Check if contains AM/PM
                if (localeTime.match(/(AM|PM|am|pm)/)) {
                    results.push('<span class="status error">❌ toLocaleTimeString содержит AM/PM</span>');
                } else {
                    results.push('<span class="status success">✅ toLocaleTimeString работает правильно</span>');
                }
            } catch (e) {
                document.getElementById('locale-time-24').textContent = 'Ошибка: ' + e.message;
                results.push('<span class="status error">❌ Ошибка в toLocaleTimeString</span>');
            }
            
            // Method 2: Manual formatting
            const manualTime = formatTime24(now);
            document.getElementById('manual-time-24').textContent = manualTime;
            results.push('<span class="status success">✅ Ручное форматирование работает</span>');
            
            // Update current time display
            document.getElementById('current-time-24').textContent = manualTime;
            
            // Check for AM/PM
            const hasAmPm = localeTime && localeTime.match(/(AM|PM|am|pm)/);
            if (hasAmPm) {
                document.getElementById('ampm-check').textContent = '⚠️ Обнаружено AM/PM: ' + hasAmPm[0];
                document.getElementById('time-status').textContent = 'Используется 12-часовой формат';
                document.getElementById('time-status').className = 'status error';
            } else {
                document.getElementById('ampm-check').textContent = '✅ AM/PM не обнаружено';
                document.getElementById('time-status').textContent = '24-часовой формат';
                document.getElementById('time-status').className = 'status success';
            }
            
            // Check time inputs
            const timeInputs = document.querySelectorAll('input[type="time"]');
            let inputsOk = true;
            timeInputs.forEach((input, index) => {
                if (input.value && !input.value.match(/^\\d{2}:\\d{2}$/)) {
                    inputsOk = false;
                }
            });
            
            if (inputsOk) {
                results.push('<span class="status success">✅ Все поля времени в правильном формате</span>');
            } else {
                results.push('<span class="status error">❌ Некоторые поля времени в неправильном формате</span>');
            }
            
            // Display results
            document.getElementById('test-results').innerHTML = results.join('<br>');
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            enforceTime24Format();
            updateTimeDisplays();
            setInterval(updateTimeDisplays, 1000);
        });
    </script>
</body>
</html>